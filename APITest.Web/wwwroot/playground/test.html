<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <script src="/lib/protobufjs/dist/protobuf.js"></script>
    <script>
        var WSMessage;
        var MessageType;


        var builder = protobuf.loadSync("/lib/protobufjs/WSMessage.proto","APITest.Web.HttpAgent");

        var ssss = builder.build("APITest.Web.HttpAgent.WSMessage");

        protobuf.load("/lib/protobufjs/WSMessage.proto", function (err, root) {
            if (err) throw err;
            WSMessage = root.lookup("APITest.Web.HttpAgent.WSMessage");
            MessageType = root.lookup("APITest.Web.HttpAgent.MessageType");
        });
    </script>
    <script>
        function LRscript() {
            var EXTRARES = new Object();
            var LAST = new Object();
            var ENDITEM = new Object();

             
            function web_url(name) {
                for (var i = 0; i < arguments.length; i++) {
                    if (arguments[i] === EXTRARES) console.log("...................");
                    console.log(arguments[i]);
                }
            }



            return {
                run: function (str) {
                    eval(str)
                }
            }
        }


        var lr = LRscript();

        var code = '\
    web_url("sign_in",\
        "URL=Http://testerhome.com/account/sign_in",\
            "Resource=0",\
            "RecContentType=text/html",\
            "Referer=https://testerhome.com/",\
            "Snapshot=t3.inf",\
            "Mode=HTML",\
            EXTRARES,\
            "Url=https://www.google-analytics.com/collect?v=1&_v=j60&a=450370903&t=pageview&_s=2&dl=https%3A%2F%2Ftesterhome.com%2F&ul=zh-cn&de=utf-8&dt=%E7%99%BB%E5%BD%95%20%C2%B7%20TesterHome&sd=24-bit&sr=1280x800&vp=792x544&je=1&fl=20.0%20r0&_u=KGBAgEQ~&jid=&gjid=&cid=364379208.1504577662&tid=UA-45014075-1&_gid=1432109762.1504577662&z=667031373", ENDITEM,\
            LAST);\
';

        lr.run(code);


        var wsUri = "ws://" + window.location.host + "/WS/HttpAgent";

        websocket = new WebSocket(wsUri);
        websocket.onopen = function (evt) {


           


            websocket.send("control");
            console.log("websocekt链接中,请耐心等待...");

           
        };
        websocket.onclose = function (evt) {
            console.log('<span style="color: red;">链接关闭!</span> ');
        };
        websocket.onmessage = function (evt) {
            var reader = new FileReader();
            reader.readAsArrayBuffer(evt.data);
            reader.onload = function (e) {
                var buf = new Uint8Array(reader.result);
                var msg = WSMessage.decode(buf)
                if (msg.type == MessageType.values.Log) {
                    console.log("是LOG");
                }
            }
        };
        websocket.onerror = function (evt) {
            
            console.log('<span style="color: red;">WebSocek 错误,您可以刷新页面重新尝试 或 将相关错误信息发送给管理人员!</span> ');
        };


    </script>

</body>



</html>